name: ikuuu_checkin

on:
  workflow_dispatch:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  schedule:
    - cron: "30 16 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install requirements
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 可选：安全自检（不泄露 token，只看是否注入成功）
      - name: Debug env (safe)
        run: |
          python - << 'PY'
          import os
          v = os.getenv("PUSHPLUS_TOKEN", "")
          print("PUSHPLUS_TOKEN exists:", "PUSHPLUS_TOKEN" in os.environ)
          print("PUSHPLUS_TOKEN length:", len(v))
          PY
        env:
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}

      - name: Checkin
        run: |
          python main.py
        env:
          EMAIL: ${{ secrets.EMAIL }}
          PASSWORD: ${{ secrets.PASSWORD }}
          DOMAIN: ${{ secrets.DOMAIN }}

          # PushPlus（必填）
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}

          # PushPlus（可选：二选一；都不填=发给自己）
          PUSHPLUS_TOPIC: ${{ secrets.PUSHPLUS_TOPIC }}
          PUSHPLUS_TO: ${{ secrets.PUSHPLUS_TO }}

          # PushPlus（可选）
          PUSHPLUS_TEMPLATE: markdown
